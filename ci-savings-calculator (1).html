<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="author" content="Pierre-Cyril Denant">
    <title>Continuous Improvement Impact Calculator (v1.3)</title>
    <link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Mono:wght@400;500;600&family=Inter:wght@300;400;600&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg: #0a0e14;
            --surface: #1a1f29;
            --border: #2d3340;
            --text-primary: #e6e8eb;
            --text-secondary: #8b92a0;
            --accent: #00d4aa;
            --accent-dim: #00aa88;
            --danger: #ff6b6b;
            --warning: #ffd93d;
            --success: #6bcf7f;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', sans-serif;
            background: var(--bg);
            color: var(--text-primary);
            line-height: 1.6;
            padding: 2rem 1rem;
            min-height: 100vh;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        header {
            margin-bottom: 3rem;
            border-bottom: 1px solid var(--border);
            padding-bottom: 1.5rem;
        }

        h1 {
            font-family: 'IBM Plex Mono', monospace;
            font-size: 2rem;
            font-weight: 600;
            letter-spacing: -0.02em;
            margin-bottom: 0.5rem;
        }

        .subtitle {
            color: var(--text-secondary);
            font-size: 0.95rem;
        }

        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .section {
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 1.5rem;
        }

        .section-title {
            font-family: 'IBM Plex Mono', monospace;
            font-size: 0.75rem;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            color: var(--accent);
            margin-bottom: 1.25rem;
            font-weight: 600;
        }

        .input-group {
            margin-bottom: 1rem;
        }

        .input-group:last-child {
            margin-bottom: 0;
        }

        label {
            display: block;
            font-size: 0.875rem;
            color: var(--text-secondary);
            margin-bottom: 0.4rem;
            font-weight: 400;
        }

        .input-wrapper {
            position: relative;
            display: flex;
            align-items: center;
        }

        input[type="number"],
        input[type="date"] {
            width: 100%;
            background: var(--bg);
            border: 1px solid var(--border);
            color: var(--text-primary);
            padding: 0.65rem 0.85rem;
            border-radius: 4px;
            font-size: 0.95rem;
            font-family: 'IBM Plex Mono', monospace;
            transition: all 0.2s;
        }

        input[type="number"]:focus,
        input[type="date"]:focus {
            outline: none;
            border-color: var(--accent);
            box-shadow: 0 0 0 3px rgba(0, 212, 170, 0.1);
        }

        .unit {
            position: absolute;
            right: 0.85rem;
            color: var(--text-secondary);
            font-size: 0.85rem;
            font-family: 'IBM Plex Mono', monospace;
            pointer-events: none;
        }

        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 1rem;
        }

        .summary {
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 2rem;
            margin-top: 2rem;
        }

        .summary-title {
            font-family: 'IBM Plex Mono', monospace;
            font-size: 0.75rem;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            color: var(--accent);
            margin-bottom: 1.5rem;
            font-weight: 600;
        }

        .summary-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1.5rem;
            margin-bottom: 1.5rem;
        }

        .summary-item {
            padding: 1rem;
            background: var(--bg);
            border-radius: 6px;
            border-left: 3px solid var(--border);
        }

        .summary-item.positive {
            border-left-color: var(--success);
        }

        .summary-item.negative {
            border-left-color: var(--danger);
        }

        .summary-label {
            font-size: 0.8rem;
            color: var(--text-secondary);
            margin-bottom: 0.4rem;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .summary-value {
            font-family: 'IBM Plex Mono', monospace;
            font-size: 1.5rem;
            font-weight: 600;
        }

        .summary-value.positive {
            color: var(--success);
        }

        .summary-value.negative {
            color: var(--danger);
        }

        .summary-period {
            font-size: 0.75rem;
            color: var(--text-secondary);
            margin-top: 0.3rem;
        }

        .summary-improvement {
            font-size: 0.75rem;
            font-family: 'IBM Plex Mono', monospace;
            font-weight: 600;
        }

        .summary-improvement.positive {
            color: var(--success);
        }

        .summary-improvement.negative {
            color: var(--danger);
        }

        .total-line {
            border-top: 2px solid var(--border);
            padding-top: 1.5rem;
            margin-top: 1.5rem;
        }

        .total-value {
            font-size: 2rem;
        }

        .btn {
            background: var(--accent);
            color: var(--bg);
            border: none;
            padding: 0.85rem 1.5rem;
            border-radius: 4px;
            font-family: 'IBM Plex Mono', monospace;
            font-size: 0.85rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .btn:hover {
            background: var(--accent-dim);
            transform: translateY(-1px);
        }

        .btn:active {
            transform: translateY(0);
        }

        .breakdown {
            margin-top: 2rem;
            padding-top: 2rem;
            border-top: 1px solid var(--border);
            display: none;
        }

        .breakdown.visible {
            display: block;
            animation: fadeIn 0.3s ease-in;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .breakdown-section {
            margin-bottom: 2rem;
        }

        .breakdown-section:last-child {
            margin-bottom: 0;
        }

        .breakdown-header {
            font-family: 'IBM Plex Mono', monospace;
            font-size: 0.9rem;
            color: var(--accent);
            margin-bottom: 1rem;
            font-weight: 600;
        }

        .breakdown-formula {
            background: var(--bg);
            padding: 1rem;
            border-radius: 4px;
            margin-bottom: 1rem;
            border-left: 3px solid var(--accent);
        }

        .breakdown-formula-title {
            font-size: 0.75rem;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            color: var(--text-secondary);
            margin-bottom: 0.5rem;
        }

        .breakdown-formula-text {
            font-family: 'IBM Plex Mono', monospace;
            font-size: 0.85rem;
            color: var(--text-primary);
            margin-bottom: 0.5rem;
        }

        .breakdown-rationale {
            font-size: 0.8rem;
            color: var(--text-secondary);
            font-style: italic;
            margin-top: 0.5rem;
        }

        .breakdown-detail {
            display: flex;
            justify-content: space-between;
            padding: 0.5rem 0;
            border-bottom: 1px solid var(--border);
            font-size: 0.875rem;
        }

        .breakdown-detail:last-child {
            border-bottom: none;
        }

        .breakdown-label {
            color: var(--text-secondary);
        }

        .breakdown-value {
            font-family: 'IBM Plex Mono', monospace;
            color: var(--text-primary);
        }

        footer {
            margin-top: 4rem;
            padding-top: 2rem;
            border-top: 1px solid var(--border);
            text-align: center;
            color: var(--text-secondary);
            font-size: 0.85rem;
        }

        footer a {
            color: var(--accent);
            text-decoration: none;
            transition: color 0.2s;
        }

        footer a:hover {
            color: var(--text-primary);
        }

        .toast {
            position: fixed;
            top: 2rem;
            right: 2rem;
            background: var(--accent);
            color: var(--bg);
            padding: 0.85rem 1.25rem;
            border-radius: 4px;
            font-family: 'IBM Plex Mono', monospace;
            font-size: 0.85rem;
            font-weight: 600;
            opacity: 0;
            transform: translateY(-20px);
            transition: all 0.3s ease;
            pointer-events: none;
            z-index: 1000;
        }

        .toast.show {
            opacity: 1;
            transform: translateY(0);
        }

        .action-buttons {
            display: flex;
            gap: 1rem;
            margin-top: 1.5rem;
            flex-wrap: wrap;
        }

        .btn-secondary {
            background: transparent;
            color: var(--accent);
            border: 1px solid var(--accent);
            padding: 0.85rem 1.5rem;
            border-radius: 4px;
            font-family: 'IBM Plex Mono', monospace;
            font-size: 0.85rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .btn-secondary:hover {
            background: rgba(0, 212, 170, 0.1);
        }

        .btn-danger {
            background: transparent;
            color: var(--danger);
            border: 1px solid var(--danger);
            padding: 0.85rem 1.5rem;
            border-radius: 4px;
            font-family: 'IBM Plex Mono', monospace;
            font-size: 0.85rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .btn-danger:hover {
            background: rgba(255, 107, 107, 0.1);
        }

        .note {
            margin-top: 1.5rem;
            padding: 1rem;
            background: rgba(0, 212, 170, 0.05);
            border-left: 3px solid var(--accent);
            border-radius: 4px;
            font-size: 0.85rem;
            color: var(--text-secondary);
        }

        @media (max-width: 768px) {
            .grid {
                grid-template-columns: 1fr;
            }

            .metrics-grid {
                grid-template-columns: 1fr;
            }

            h1 {
                font-size: 1.5rem;
            }

            .total-value {
                font-size: 1.5rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>Continuous Improvement Impact Calculator (v1.3)</h1>
            <p class="subtitle">Quantifies the Business Value of Continuous Improvement</p>
        </header>

        <div class="grid">
            <!-- Team Economics -->
            <div class="section">
                <h2 class="section-title">Team Economics</h2>
                <div class="input-group">
                    <label for="blendRate">Blend Rate</label>
                    <div class="input-wrapper">
                        <input type="number" id="blendRate" value="125" step="1" min="0">
                        <span class="unit">$/hour</span>
                    </div>
                </div>
                <div class="input-group">
                    <label for="hoursPerDay">Hours per Day</label>
                    <div class="input-wrapper">
                        <input type="number" id="hoursPerDay" value="6.5" step="0.5" min="0">
                        <span class="unit">hours</span>
                    </div>
                </div>
                <div class="input-group">
                    <label for="teamSize">Team Size</label>
                    <div class="input-wrapper">
                        <input type="number" id="teamSize" value="7" step="1" min="1">
                        <span class="unit">people</span>
                    </div>
                </div>
                <div class="input-group">
                    <label for="workingDaysPerWeek">Working Days per Week</label>
                    <div class="input-wrapper">
                        <input type="number" id="workingDaysPerWeek" value="5" step="1" min="1" max="7">
                        <span class="unit">days</span>
                    </div>
                </div>
                <div class="input-group">
                    <label for="workingDaysPerMonth">Working Days per Month</label>
                    <div class="input-wrapper">
                        <input type="number" id="workingDaysPerMonth" value="20" step="1" min="1">
                        <span class="unit">days</span>
                    </div>
                </div>
            </div>

            <!-- Improvement Period -->
            <div class="section">
                <h2 class="section-title">Improvement Period</h2>
                <div class="input-group">
                    <label for="startDate">Start Date</label>
                    <input type="date" id="startDate" value="2024-08-01">
                </div>
                <div class="input-group">
                    <label for="endDate">End Date</label>
                    <input type="date" id="endDate" value="2025-01-31">
                </div>
            </div>

            <!-- Flow Metrics -->
            <div class="section">
                <h2 class="section-title">Flow Metrics</h2>
                <div class="input-group">
                    <label>Throughput (items/month)</label>
                    <div class="metrics-grid">
                        <div>
                            <label style="font-size: 0.75rem; margin-bottom: 0.3rem;">Start</label>
                            <div class="input-wrapper">
                                <input type="number" id="throughputPrev" value="50" step="1" min="0">
                            </div>
                        </div>
                        <div>
                            <label style="font-size: 0.75rem; margin-bottom: 0.3rem;">End</label>
                            <div class="input-wrapper">
                                <input type="number" id="throughputCurr" value="40" step="1" min="0">
                            </div>
                        </div>
                    </div>
                </div>
                <div class="input-group">
                    <label>Lead Time (days)</label>
                    <div class="metrics-grid">
                        <div>
                            <label style="font-size: 0.75rem; margin-bottom: 0.3rem;">Start</label>
                            <div class="input-wrapper">
                                <input type="number" id="leadTimePrev" value="45" step="1" min="0">
                            </div>
                        </div>
                        <div>
                            <label style="font-size: 0.75rem; margin-bottom: 0.3rem;">End</label>
                            <div class="input-wrapper">
                                <input type="number" id="leadTimeCurr" value="25" step="1" min="0">
                            </div>
                        </div>
                    </div>
                </div>
                <div class="input-group">
                    <label>WIP (items/month)</label>
                    <div class="metrics-grid">
                        <div>
                            <label style="font-size: 0.75rem; margin-bottom: 0.3rem;">Start</label>
                            <div class="input-wrapper">
                                <input type="number" id="wipPrev" value="25" step="1" min="0">
                            </div>
                        </div>
                        <div>
                            <label style="font-size: 0.75rem; margin-bottom: 0.3rem;">End</label>
                            <div class="input-wrapper">
                                <input type="number" id="wipCurr" value="25" step="1" min="0">
                            </div>
                        </div>
                    </div>
                </div>
                <div class="input-group">
                    <label>Defects (count/month)</label>
                    <div class="metrics-grid">
                        <div>
                            <label style="font-size: 0.75rem; margin-bottom: 0.3rem;">Start</label>
                            <div class="input-wrapper">
                                <input type="number" id="defectsPrev" value="8" step="1" min="0">
                            </div>
                        </div>
                        <div>
                            <label style="font-size: 0.75rem; margin-bottom: 0.3rem;">End</label>
                            <div class="input-wrapper">
                                <input type="number" id="defectsCurr" value="25" step="1" min="0">
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Summary -->
        <div class="summary">
            <h2 class="summary-title" id="summaryTitle">Period Savings Summary</h2>
            <div class="summary-grid">
                <div class="summary-item" id="productivityItem">
                    <div class="summary-label">
                        <span>Productivity</span>
                        <span class="summary-improvement" id="productivityImprovement">0%</span>
                    </div>
                    <div class="summary-value" id="productivityPeriod">0$</div>
                    <div class="summary-period" id="productivityAnnual">Projected Annual: 0$</div>
                </div>
                <div class="summary-item" id="timeToMarketItem">
                    <div class="summary-label">
                        <span>Time-to-Market</span>
                        <span class="summary-improvement" id="timeToMarketImprovement">0%</span>
                    </div>
                    <div class="summary-value" id="timeToMarketPeriod">0$</div>
                    <div class="summary-period" id="timeToMarketAnnual">Projected Annual: 0$</div>
                </div>
                <div class="summary-item" id="efficiencyItem">
                    <div class="summary-label">
                        <span>Efficiency (WIP)</span>
                        <span class="summary-improvement" id="efficiencyImprovement">0%</span>
                    </div>
                    <div class="summary-value" id="efficiencyPeriod">0$</div>
                    <div class="summary-period" id="efficiencyAnnual">Projected Annual: 0$</div>
                </div>
                <div class="summary-item" id="qualityItem">
                    <div class="summary-label">
                        <span>Quality</span>
                        <span class="summary-improvement" id="qualityImprovement">0%</span>
                    </div>
                    <div class="summary-value" id="qualityPeriod">0$</div>
                    <div class="summary-period" id="qualityAnnual">Projected Annual: 0$</div>
                </div>
            </div>

            <div class="total-line">
                <div class="summary-grid">
                    <div class="summary-item" id="totalItem">
                        <div class="summary-label">Total Impact</div>
                        <div class="summary-value total-value" id="totalPeriod">0$</div>
                        <div class="summary-period" id="totalAnnual">Projected Annual: 0$</div>
                    </div>
                </div>
            </div>

            <div class="note">
                <strong>Positive values</strong> = Savings (green) ‚Ä¢ <strong>Negative values</strong> = Cost increase (red)
            </div>

            <div class="action-buttons">
                <button class="btn" id="toggleBreakdown">Show Breakdown</button>
                <button class="btn-secondary" id="saveShareLink">Save/Share Link</button>
                <button class="btn-danger" id="clearData">Clear Saved Data</button>
            </div>

            <!-- Breakdown -->
            <div class="breakdown" id="breakdown">
                <div class="breakdown-section">
                    <div class="breakdown-header">Productivity Details</div>
                    <div class="breakdown-formula">
                        <div class="breakdown-formula-title">Formula</div>
                        <div class="breakdown-formula-text" id="bd-productivity-formula">Impact = -((Cost/Item End - Cost/Item Start) √ó Items/Month √ó Months)</div>
                        <div class="breakdown-rationale">Lower cost per item = positive savings. Negative sign converts cost increase to negative impact.</div>
                    </div>
                    <div class="breakdown-detail">
                        <span class="breakdown-label">Cost per Item (Start)</span>
                        <span class="breakdown-value" id="bd-cost-prev">0$</span>
                    </div>
                    <div class="breakdown-detail">
                        <span class="breakdown-label">Cost per Item (End)</span>
                        <span class="breakdown-value" id="bd-cost-curr">0$</span>
                    </div>
                    <div class="breakdown-detail">
                        <span class="breakdown-label">Change per Item</span>
                        <span class="breakdown-value" id="bd-change-item">0$</span>
                    </div>
                    <div class="breakdown-detail">
                        <span class="breakdown-label">Items per Month (End)</span>
                        <span class="breakdown-value" id="bd-items-month-prod">0</span>
                    </div>
                    <div class="breakdown-detail">
                        <span class="breakdown-label">Period (months)</span>
                        <span class="breakdown-value" id="bd-months-prod">0</span>
                    </div>
                </div>

                <div class="breakdown-section">
                    <div class="breakdown-header">Time-to-Market Details</div>
                    <div class="breakdown-formula">
                        <div class="breakdown-formula-title">Formula</div>
                        <div class="breakdown-formula-text" id="bd-ttm-formula">Impact = -((Lead Time End - Lead Time Start) √ó Daily Cost √ó Items/Month √ó Months)</div>
                        <div class="breakdown-rationale">Reduced lead time accelerates value delivery. Each day saved per item multiplies across throughput and time.</div>
                    </div>
                    <div class="breakdown-detail">
                        <span class="breakdown-label">Lead Time Change (days)</span>
                        <span class="breakdown-value" id="bd-lt-change">0</span>
                    </div>
                    <div class="breakdown-detail">
                        <span class="breakdown-label">Daily Cost</span>
                        <span class="breakdown-value" id="bd-daily-cost">0$</span>
                    </div>
                    <div class="breakdown-detail">
                        <span class="breakdown-label">Items per Month (End)</span>
                        <span class="breakdown-value" id="bd-items-month">0</span>
                    </div>
                    <div class="breakdown-detail">
                        <span class="breakdown-label">Period (months)</span>
                        <span class="breakdown-value" id="bd-months">0</span>
                    </div>
                </div>

                <div class="breakdown-section">
                    <div class="breakdown-header">Efficiency (WIP) Details</div>
                    <div class="breakdown-formula">
                        <div class="breakdown-formula-title">Formula</div>
                        <div class="breakdown-formula-text" id="bd-wip-formula">Impact = -((WIP End - WIP Start) √ó Cost/Item √ó Months)</div>
                        <div class="breakdown-rationale">Lower WIP reduces inventory carrying cost and improves flow. Each WIP item ties up resources.</div>
                    </div>
                    <div class="breakdown-detail">
                        <span class="breakdown-label">WIP Change</span>
                        <span class="breakdown-value" id="bd-wip-change">0</span>
                    </div>
                    <div class="breakdown-detail">
                        <span class="breakdown-label">Cost per Item (End)</span>
                        <span class="breakdown-value" id="bd-wip-cost">0$</span>
                    </div>
                    <div class="breakdown-detail">
                        <span class="breakdown-label">Period (months)</span>
                        <span class="breakdown-value" id="bd-months-wip">0</span>
                    </div>
                </div>

                <div class="breakdown-section">
                    <div class="breakdown-header">Quality Details</div>
                    <div class="breakdown-formula">
                        <div class="breakdown-formula-title">Formula</div>
                        <div class="breakdown-formula-text" id="bd-quality-formula">Impact = -((Defects End - Defects Start) √ó Cost/Item √ó Months)</div>
                        <div class="breakdown-rationale">Fewer defects reduce rework cost. Each defect requires full item cost to remediate.</div>
                    </div>
                    <div class="breakdown-detail">
                        <span class="breakdown-label">Defects Change</span>
                        <span class="breakdown-value" id="bd-defects-change">0</span>
                    </div>
                    <div class="breakdown-detail">
                        <span class="breakdown-label">Cost per Item (End)</span>
                        <span class="breakdown-value" id="bd-defects-cost">0$</span>
                    </div>
                    <div class="breakdown-detail">
                        <span class="breakdown-label">Period (months)</span>
                        <span class="breakdown-value" id="bd-months-quality">0</span>
                    </div>
                </div>
            </div>
        </div>

        <footer>
            Made with ‚ù§Ô∏è and üçÅ Syrup by Pierre-Cyril Denant - 2026 - 
            <a href="https://collaborationsolved.com" target="_blank">collaborationsolved.com</a> - 
            <a href="https://github.com/pcdenant/Continuous-Improvement-Calculator/issues" target="_blank">report an issue</a>
        </footer>
    </div>

    <div class="toast" id="toast"></div>

    <script>
        // Toast notification
        function showToast(message, duration = 2000) {
            const toast = document.getElementById('toast');
            toast.textContent = message;
            toast.classList.add('show');
            setTimeout(() => {
                toast.classList.remove('show');
            }, duration);
        }

        // Get all input values as object
        function getAllValues() {
            return {
                blendRate: document.getElementById('blendRate').value,
                hoursPerDay: document.getElementById('hoursPerDay').value,
                teamSize: document.getElementById('teamSize').value,
                workingDaysPerWeek: document.getElementById('workingDaysPerWeek').value,
                workingDaysPerMonth: document.getElementById('workingDaysPerMonth').value,
                startDate: document.getElementById('startDate').value,
                endDate: document.getElementById('endDate').value,
                throughputPrev: document.getElementById('throughputPrev').value,
                throughputCurr: document.getElementById('throughputCurr').value,
                leadTimePrev: document.getElementById('leadTimePrev').value,
                leadTimeCurr: document.getElementById('leadTimeCurr').value,
                wipPrev: document.getElementById('wipPrev').value,
                wipCurr: document.getElementById('wipCurr').value,
                defectsPrev: document.getElementById('defectsPrev').value,
                defectsCurr: document.getElementById('defectsCurr').value
            };
        }

        // Set all input values from object
        function setAllValues(values) {
            Object.keys(values).forEach(key => {
                const element = document.getElementById(key);
                if (element) {
                    element.value = values[key];
                }
            });
        }

        // Save to localStorage
        function saveToLocalStorage() {
            const values = getAllValues();
            localStorage.setItem('ci-calculator-data', JSON.stringify(values));
            showToast('Auto-saved ‚úì');
        }

        // Load from localStorage
        function loadFromLocalStorage() {
            const saved = localStorage.getItem('ci-calculator-data');
            if (saved) {
                try {
                    const values = JSON.parse(saved);
                    setAllValues(values);
                    return true;
                } catch (e) {
                    console.error('Error loading saved data:', e);
                    return false;
                }
            }
            return false;
        }

        // Load from URL parameters
        function loadFromURL() {
            const params = new URLSearchParams(window.location.search);
            if (params.toString()) {
                const values = {};
                params.forEach((value, key) => {
                    values[key] = value;
                });
                setAllValues(values);
                return true;
            }
            return false;
        }

        // Generate shareable URL
        function generateShareableURL() {
            const values = getAllValues();
            const params = new URLSearchParams(values);
            return window.location.origin + window.location.pathname + '?' + params.toString();
        }

        // Copy URL to clipboard
        async function copyShareableLink() {
            const url = generateShareableURL();
            try {
                await navigator.clipboard.writeText(url);
                showToast('Link copied! Share this URL to replicate this scenario', 3000);
            } catch (err) {
                // Fallback for older browsers
                const textarea = document.createElement('textarea');
                textarea.value = url;
                textarea.style.position = 'fixed';
                textarea.style.opacity = '0';
                document.body.appendChild(textarea);
                textarea.select();
                try {
                    document.execCommand('copy');
                    showToast('Link copied! Share this URL to replicate this scenario', 3000);
                } catch (e) {
                    showToast('Failed to copy link. Please copy from address bar.', 3000);
                }
                document.body.removeChild(textarea);
            }
        }

        // Clear saved data with confirmation
        function clearSavedData() {
            if (confirm('Are you sure you want to clear all saved data? This will reset all fields to default values.')) {
                localStorage.removeItem('ci-calculator-data');
                // Reset to default values
                document.getElementById('blendRate').value = 125;
                document.getElementById('hoursPerDay').value = 6.5;
                document.getElementById('teamSize').value = 7;
                document.getElementById('workingDaysPerWeek').value = 5;
                document.getElementById('workingDaysPerMonth').value = 20;
                document.getElementById('startDate').value = '2024-08-01';
                document.getElementById('endDate').value = '2025-01-31';
                document.getElementById('throughputPrev').value = 50;
                document.getElementById('throughputCurr').value = 40;
                document.getElementById('leadTimePrev').value = 45;
                document.getElementById('leadTimeCurr').value = 25;
                document.getElementById('wipPrev').value = 25;
                document.getElementById('wipCurr').value = 25;
                document.getElementById('defectsPrev').value = 8;
                document.getElementById('defectsCurr').value = 25;
                calculate();
                showToast('Data cleared and reset to defaults', 2000);
            }
        }

        // Format date for display
        function formatDate(dateString) {
            const date = new Date(dateString);
            const options = { year: 'numeric', month: 'long', day: 'numeric' };
            return date.toLocaleDateString('en-US', options);
        }

        // Update summary title with dates
        function updateSummaryTitle() {
            const startDate = document.getElementById('startDate').value;
            const endDate = document.getElementById('endDate').value;
            const title = `Period Savings Summary (from ${formatDate(startDate)} to ${formatDate(endDate)})`;
            document.getElementById('summaryTitle').textContent = title;
        }

        // Calculate months between dates
        function calculateMonths(start, end) {
            const startDate = new Date(start);
            const endDate = new Date(end);
            const months = (endDate.getFullYear() - startDate.getFullYear()) * 12 
                         + (endDate.getMonth() - startDate.getMonth());
            return Math.max(1, months);
        }

        // Format currency (with K$ and M$ suffixes, one decimal)
        function formatCurrency(value) {
            const rounded = Math.round(value);
            const absValue = Math.abs(rounded);
            const sign = rounded >= 0 ? '' : '-';
            
            let formatted;
            if (absValue >= 1000000) {
                formatted = (absValue / 1000000).toFixed(1) + ' M$';
            } else if (absValue >= 1000) {
                formatted = (absValue / 1000).toFixed(1) + ' K$';
            } else if (absValue >= 1) {
                formatted = absValue.toFixed(1) + '$';
            } else {
                formatted = absValue.toFixed(1) + '$';
            }
            
            return sign + formatted;
        }

        // Format percentage
        function formatPercentage(value) {
            const rounded = Math.round(value);
            return rounded >= 0 ? `+${rounded}%` : `${rounded}%`;
        }

        // Update improvement percentage styling
        function updateImprovementStyle(element, value) {
            element.classList.remove('positive', 'negative');
            if (value > 0) {
                element.classList.add('positive');
            } else if (value < 0) {
                element.classList.add('negative');
            }
        }

        // Update summary item styling
        function updateItemStyle(element, value) {
            element.classList.remove('positive', 'negative');
            if (value > 0) {
                element.classList.add('positive');
            } else if (value < 0) {
                element.classList.add('negative');
            }
        }

        // Calculate and update
        function calculate() {
            // Update summary title with dates
            updateSummaryTitle();

            // Auto-save to localStorage
            saveToLocalStorage();

            // Get team economics
            const blendRate = parseFloat(document.getElementById('blendRate').value);
            const hoursPerDay = parseFloat(document.getElementById('hoursPerDay').value);
            const teamSize = parseFloat(document.getElementById('teamSize').value);
            const workingDaysPerWeek = parseFloat(document.getElementById('workingDaysPerWeek').value);
            const workingDaysPerMonth = parseFloat(document.getElementById('workingDaysPerMonth').value);

            // Calculate costs
            const dailyCost = blendRate * hoursPerDay * teamSize;
            const weeklyCost = dailyCost * workingDaysPerWeek;
            const monthlyCost = dailyCost * workingDaysPerMonth;

            // Get period
            const startDate = document.getElementById('startDate').value;
            const endDate = document.getElementById('endDate').value;
            const months = calculateMonths(startDate, endDate);

            // Get flow metrics
            const throughputPrev = parseFloat(document.getElementById('throughputPrev').value);
            const throughputCurr = parseFloat(document.getElementById('throughputCurr').value);
            const leadTimePrev = parseFloat(document.getElementById('leadTimePrev').value);
            const leadTimeCurr = parseFloat(document.getElementById('leadTimeCurr').value);
            const wipPrev = parseFloat(document.getElementById('wipPrev').value);
            const wipCurr = parseFloat(document.getElementById('wipCurr').value);
            const defectsPrev = parseFloat(document.getElementById('defectsPrev').value);
            const defectsCurr = parseFloat(document.getElementById('defectsCurr').value);

            // TIME-TO-MARKET (reduction in lead time = savings = positive)
            const leadTimeChange = leadTimeCurr - leadTimePrev;
            const ttmPeriod = -leadTimeChange * dailyCost * throughputCurr * months;
            const ttmAnnual = (ttmPeriod / months) * 12;

            // PRODUCTIVITY (reduction in cost/item = savings = positive)
            const costPerItemPrev = monthlyCost / throughputPrev;
            const costPerItemCurr = monthlyCost / throughputCurr;
            const changePerItem = costPerItemCurr - costPerItemPrev;
            const productivityPeriod = -changePerItem * throughputCurr * months;
            const productivityAnnual = (productivityPeriod / months) * 12;

            // EFFICIENCY (reduction in WIP = savings = positive)
            const wipChange = wipCurr - wipPrev;
            const efficiencyPeriod = -wipChange * costPerItemCurr * months;
            const efficiencyAnnual = (efficiencyPeriod / months) * 12;

            // QUALITY (reduction in defects = savings = positive)
            const defectsChange = defectsCurr - defectsPrev;
            const qualityPeriod = -defectsChange * costPerItemCurr * months;
            const qualityAnnual = (qualityPeriod / months) * 12;

            // TOTALS
            const totalPeriod = ttmPeriod + productivityPeriod + efficiencyPeriod + qualityPeriod;
            const totalAnnual = ttmAnnual + productivityAnnual + efficiencyAnnual + qualityAnnual;

            // Calculate improvement percentages
            const productivityImprovement = throughputPrev > 0 ? ((throughputCurr - throughputPrev) / throughputPrev * 100) : 0;
            const ttmImprovement = leadTimePrev > 0 ? ((leadTimePrev - leadTimeCurr) / leadTimePrev * 100) : 0;
            const wipImprovement = wipPrev > 0 ? ((wipPrev - wipCurr) / wipPrev * 100) : 0;
            const qualityImprovement = defectsPrev > 0 ? ((defectsPrev - defectsCurr) / defectsPrev * 100) : 0;

            // Update summary
            document.getElementById('productivityPeriod').textContent = formatCurrency(productivityPeriod);
            document.getElementById('productivityImprovement').textContent = formatPercentage(productivityImprovement);
            document.getElementById('productivityAnnual').textContent = `Projected Annual: ${formatCurrency(productivityAnnual)}`;
            updateItemStyle(document.getElementById('productivityItem'), productivityPeriod);
            updateImprovementStyle(document.getElementById('productivityImprovement'), productivityImprovement);

            document.getElementById('timeToMarketPeriod').textContent = formatCurrency(ttmPeriod);
            document.getElementById('timeToMarketImprovement').textContent = formatPercentage(ttmImprovement);
            document.getElementById('timeToMarketAnnual').textContent = `Projected Annual: ${formatCurrency(ttmAnnual)}`;
            updateItemStyle(document.getElementById('timeToMarketItem'), ttmPeriod);
            updateImprovementStyle(document.getElementById('timeToMarketImprovement'), ttmImprovement);

            document.getElementById('efficiencyPeriod').textContent = formatCurrency(efficiencyPeriod);
            document.getElementById('efficiencyImprovement').textContent = formatPercentage(wipImprovement);
            document.getElementById('efficiencyAnnual').textContent = `Projected Annual: ${formatCurrency(efficiencyAnnual)}`;
            updateItemStyle(document.getElementById('efficiencyItem'), efficiencyPeriod);
            updateImprovementStyle(document.getElementById('efficiencyImprovement'), wipImprovement);

            document.getElementById('qualityPeriod').textContent = formatCurrency(qualityPeriod);
            document.getElementById('qualityImprovement').textContent = formatPercentage(qualityImprovement);
            document.getElementById('qualityAnnual').textContent = `Projected Annual: ${formatCurrency(qualityAnnual)}`;
            updateItemStyle(document.getElementById('qualityItem'), qualityPeriod);
            updateImprovementStyle(document.getElementById('qualityImprovement'), qualityImprovement);

            document.getElementById('totalPeriod').textContent = formatCurrency(totalPeriod);
            document.getElementById('totalAnnual').textContent = `Projected Annual: ${formatCurrency(totalAnnual)}`;
            updateItemStyle(document.getElementById('totalItem'), totalPeriod);

            // Update breakdown
            document.getElementById('bd-lt-change').textContent = leadTimeChange.toFixed(0);
            document.getElementById('bd-daily-cost').textContent = formatCurrency(dailyCost);
            document.getElementById('bd-items-month').textContent = throughputCurr.toFixed(0);
            document.getElementById('bd-months').textContent = months;

            document.getElementById('bd-cost-prev').textContent = formatCurrency(costPerItemPrev);
            document.getElementById('bd-cost-curr').textContent = formatCurrency(costPerItemCurr);
            document.getElementById('bd-change-item').textContent = formatCurrency(changePerItem);
            document.getElementById('bd-items-month-prod').textContent = throughputCurr.toFixed(0);
            document.getElementById('bd-months-prod').textContent = months;

            document.getElementById('bd-wip-change').textContent = wipChange.toFixed(0);
            document.getElementById('bd-wip-cost').textContent = formatCurrency(costPerItemCurr);
            document.getElementById('bd-months-wip').textContent = months;

            document.getElementById('bd-defects-change').textContent = defectsChange.toFixed(0);
            document.getElementById('bd-defects-cost').textContent = formatCurrency(costPerItemCurr);
            document.getElementById('bd-months-quality').textContent = months;

            // Update formulas with actual values
            document.getElementById('bd-productivity-formula').textContent = 
                `Impact = -((${formatCurrency(costPerItemCurr)} - ${formatCurrency(costPerItemPrev)}) √ó ${throughputCurr.toFixed(0)} √ó ${months}) = ${formatCurrency(productivityPeriod)}`;
            
            document.getElementById('bd-ttm-formula').textContent = 
                `Impact = -(${leadTimeChange.toFixed(0)} √ó ${formatCurrency(dailyCost)} √ó ${throughputCurr.toFixed(0)} √ó ${months}) = ${formatCurrency(ttmPeriod)}`;
            
            document.getElementById('bd-wip-formula').textContent = 
                `Impact = -(${wipChange.toFixed(0)} √ó ${formatCurrency(costPerItemCurr)} √ó ${months}) = ${formatCurrency(efficiencyPeriod)}`;
            
            document.getElementById('bd-quality-formula').textContent = 
                `Impact = -(${defectsChange.toFixed(0)} √ó ${formatCurrency(costPerItemCurr)} √ó ${months}) = ${formatCurrency(qualityPeriod)}`;
        }

        // Toggle breakdown
        document.getElementById('toggleBreakdown').addEventListener('click', function() {
            const breakdown = document.getElementById('breakdown');
            breakdown.classList.toggle('visible');
            this.textContent = breakdown.classList.contains('visible') ? 'Hide Breakdown' : 'Show Breakdown';
        });

        // Save/Share link button
        document.getElementById('saveShareLink').addEventListener('click', copyShareableLink);

        // Clear data button
        document.getElementById('clearData').addEventListener('click', clearSavedData);

        // Add event listeners to all inputs
        const inputs = document.querySelectorAll('input');
        inputs.forEach(input => {
            input.addEventListener('input', calculate);
        });

        // Initialize: Load from URL first (priority), then localStorage, then calculate
        window.addEventListener('DOMContentLoaded', () => {
            const loadedFromURL = loadFromURL();
            if (!loadedFromURL) {
                loadFromLocalStorage();
            }
            calculate();
        });
    </script>
</body>
</html>
